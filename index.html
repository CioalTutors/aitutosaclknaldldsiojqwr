<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#84cc16">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Tutor Finder Pro</title>
    
    <link id="manifest-link" rel="manifest">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f7fee7; -webkit-tap-highlight-color: transparent; overscroll-behavior-y: contain; }
        .loading-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        select, input, textarea { appearance: none; outline: none; }
        select { background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2365a30d' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 1rem center; background-size: 1em; }
        .custom-scrollbar::-webkit-scrollbar { height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #bef264; border-radius: 10px; }
    </style>
</head>
<body class="text-slate-900 pb-10 sm:pb-0">

    <!-- Pre-loader -->
    <div id="loadingOverlay" class="fixed inset-0 bg-white z-[100] flex flex-col items-center justify-center text-center px-6">
        <div class="relative mb-8 scale-125">
            <div class="w-16 h-16 border-4 border-slate-100 border-t-lime-600 rounded-full animate-spin"></div>
            <i class="fas fa-database text-lime-600 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-xl"></i>
        </div>
        <h3 class="text-lg font-black tracking-widest uppercase text-slate-800">Tutor Database</h3>
        <p id="loadingStatus" class="text-[10px] font-bold text-slate-400 mt-2 uppercase tracking-[0.3em]">Grouping Classes & Levels</p>
    </div>

    <header class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm px-4 sm:px-6 py-4">
        <div class="max-w-[1600px] mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="bg-lime-600 p-2 rounded-xl shadow-lg shadow-lime-200">
                    <i class="fas fa-graduation-cap text-white text-lg"></i>
                </div>
                <div>
                    <h1 class="text-lg font-black tracking-tighter text-slate-800 uppercase leading-none">Tutor Finder</h1>
                    <p class="text-[9px] font-black text-lime-600 uppercase tracking-widest leading-none mt-1 italic">Recruitment Pro</p>
                </div>
            </div>
            <div class="flex items-center gap-2 bg-slate-50 px-3 py-1.5 rounded-full border border-slate-200">
                <div id="statusDot" class="w-1.5 h-1.5 rounded-full bg-amber-400"></div>
                <span id="recordCount" class="text-[9px] font-black text-slate-600 uppercase">Indexing...</span>
            </div>
        </div>
    </header>

    <main class="max-w-[1600px] mx-auto px-4 sm:px-6 py-6">
        
        <!-- Smart Message Parser -->
        <section class="mb-8 animate-fade-in">
            <div class="bg-lime-600 rounded-[2.5rem] p-6 sm:p-8 shadow-xl shadow-lime-200/50 relative overflow-hidden">
                <div class="absolute -right-10 -bottom-10 opacity-10 pointer-events-none">
                    <i class="fas fa-bolt text-[180px] text-white"></i>
                </div>
                <div class="relative z-10">
                    <div class="flex items-center gap-2 mb-4 text-white">
                        <i class="fas fa-magic text-lime-200"></i>
                        <h2 class="text-xs font-black uppercase tracking-widest">Smart Request Paste</h2>
                    </div>
                    <textarea id="smartPasteArea" oninput="handleSmartPaste()" placeholder="Paste message (e.g. Hi, I require a tutor for phy math CS in civil lines Karachi...)" class="w-full p-5 rounded-2xl bg-white/10 border-2 border-white/20 text-white placeholder:text-lime-100/50 outline-none focus:border-white/40 transition-all text-sm font-medium min-h-[80px] resize-none"></textarea>
                </div>
            </div>
        </section>

        <!-- Recruitment Filters -->
        <section class="mb-8 animate-fade-in">
            <div class="bg-white rounded-[2.5rem] p-6 sm:p-10 border border-slate-200 shadow-xl shadow-slate-200/30">
                <div class="flex items-center justify-between mb-8">
                    <div class="flex items-center gap-2">
                        <div class="w-1.5 h-5 bg-lime-500 rounded-full"></div>
                        <h2 class="text-sm font-black text-slate-800 uppercase tracking-widest">Global Selection Filters</h2>
                    </div>
                    <button onclick="resetFilters()" class="text-[10px] font-black text-slate-400 hover:text-red-500 uppercase tracking-widest transition-colors">Clear All</button>
                </div>

                <div id="filterGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5">
                    <!-- Dropdowns generated here -->
                </div>
            </div>
        </section>

        <!-- Results Table -->
        <div id="resultsWrapper" class="hidden space-y-4 animate-fade-in">
            <div class="flex items-center justify-between px-2">
                <div class="flex items-center gap-3">
                    <h3 class="text-sm font-black text-slate-800 uppercase tracking-widest">Tutor Matches</h3>
                    <span id="matchCount" class="bg-lime-500 text-white text-[10px] font-black px-3 py-1 rounded-full shadow-lg shadow-lime-100"></span>
                </div>
                
                <div class="flex items-center gap-2">
                    <button onclick="changePage(-1)" id="prevBtn" class="p-2 px-4 rounded-xl bg-white border border-slate-200 text-slate-400 hover:text-lime-600 disabled:opacity-30 transition-all">
                        <i class="fas fa-chevron-left text-[10px]"></i>
                    </button>
                    <span id="pageInfo" class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Page 1</span>
                    <button onclick="changePage(1)" id="nextBtn" class="p-2 px-4 rounded-xl bg-white border border-slate-200 text-slate-400 hover:text-lime-600 disabled:opacity-30 transition-all">
                        <i class="fas fa-chevron-right text-[10px]"></i>
                    </button>
                </div>
            </div>
            
            <div class="bg-white rounded-[2.5rem] border border-slate-200 shadow-2xl overflow-hidden">
                <div class="overflow-x-auto custom-scrollbar">
                    <table class="w-full text-left border-collapse min-w-[1500px]">
                        <thead id="tableHeader"></thead>
                        <tbody id="tableBody" class="divide-y divide-slate-50"></tbody>
                    </table>
                </div>
            </div>

            <div class="flex justify-center py-4">
                <div class="bg-white border border-slate-200 rounded-2xl shadow-lg p-2 flex items-center gap-4">
                    <button onclick="changePage(-1)" id="prevBtnBottom" class="flex items-center gap-2 px-6 py-3 rounded-xl font-black text-xs uppercase tracking-widest transition-all bg-slate-50 hover:bg-lime-600 hover:text-white disabled:opacity-20">
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <div class="h-6 w-px bg-slate-100"></div>
                    <span id="pageInfoBottom" class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] px-4">Page 1 of 1</span>
                    <div class="h-6 w-px bg-slate-100"></div>
                    <button onclick="changePage(1)" id="nextBtnBottom" class="flex items-center gap-2 px-6 py-3 rounded-xl font-black text-xs uppercase tracking-widest transition-all bg-slate-50 hover:bg-lime-600 hover:text-white disabled:opacity-20">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <div id="emptyState" class="text-center py-40 bg-white border-2 border-dashed border-slate-200 rounded-[4rem]">
            <div class="bg-lime-50 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6 text-lime-300">
                <i class="fas fa-search text-4xl"></i>
            </div>
            <h3 class="text-xl font-black text-slate-800 uppercase tracking-tighter italic tracking-widest text-center px-4">"Ready to Search"</h3>
            <p class="text-slate-400 text-[10px] font-black uppercase tracking-widest mt-2 px-8">Class options are grouped into meaningful categories</p>
        </div>
    </main>

    <script>
        const GSHEET_URL = 'https://docs.google.com/spreadsheets/d/1tb4lnBTw6f8Pa6Iko_xQvMFydHtjWsjHCIaxLkNRDVc/export?format=csv';
        let db = [];
        let filteredDb = [];
        let currentPage = 1;
        const pageSize = 10;
        let headers = [];

        const FILTER_COLS = [
            "Gender", "City", "Years of Experience", "Educational Background", 
            "Classes You Can Teach?", "Subjects you can teach?", 
            "Areas you can teach in?", "Can you teach on online platforms such as Zoom, Skype etc.?"
        ];

        const MAPPING = {
            subjects: {
                "phy": "physics", "math": "mathematics", "cs": "computer science", "comp": "computer science",
                "bio": "biology", "chem": "chemistry", "eng": "english", "psych": "psychology", "stat": "statistics"
            }
        };

        const OA_LEVEL_REGEX = /o[ -]*level|a[ -]*level/i;
        
        // Define meaningful class groups
        const CLASS_GROUPS = {
            "Primary (Grade 1-5)": ["1", "2", "3", "4", "5", "primary", "grade 1", "grade 2", "grade 3", "grade 4", "grade 5", "one", "two", "three", "four", "five"],
            "Middle (Grade 6-8)": ["6", "7", "8", "middle", "grade 6", "grade 7", "grade 8", "six", "seven", "eight"],
            "O-Level / Matric": ["9", "10", "matric", "o level", "olevel", "grade 9", "grade 10"],
            "A-Level / FSc": ["11", "12", "fsc", "a level", "alevel", "as level", "aslevel", "grade 11", "grade 12", "hssc"],
            "University / Bachelors": ["university", "bachelor", "bs", "masters", "msc", "graduate"]
        };

        function similarity(s1, s2) {
            let longer = s1, shorter = s2;
            if (s1.length < s2.length) { longer = s2; shorter = s1; }
            let longerLength = longer.length;
            if (longerLength == 0) return 1.0;
            return (longerLength - editDistance(longer, shorter)) / parseFloat(longerLength);
        }

        function editDistance(s1, s2) {
            s1 = s1.toLowerCase(); s2 = s2.toLowerCase();
            let costs = new Array();
            for (let i = 0; i <= s1.length; i++) {
                let lastValue = i;
                for (let j = 0; j <= s2.length; j++) {
                    if (i == 0) costs[j] = j;
                    else {
                        if (j > 0) {
                            let newValue = costs[j - 1];
                            if (s1.charAt(i - 1) != s2.charAt(j - 1))
                                newValue = Math.min(Math.min(newValue, lastValue), costs[j]) + 1;
                            costs[j - 1] = lastValue;
                            lastValue = newValue;
                        }
                    }
                }
                if (i > 0) costs[s2.length] = lastValue;
            }
            return costs[s2.length];
        }

        function parseCSV(text) {
            const rows = [];
            let field = '', inQuotes = false, current = [];
            for (let i = 0; i < text.length; i++) {
                const c = text[i], n = text[i+1];
                if (c === '"') {
                    if (inQuotes && n === '"') { field += '"'; i++; }
                    else inQuotes = !inQuotes;
                } else if (c === ',' && !inQuotes) { current.push(field.trim()); field = ''; }
                else if ((c === '\n' || c === '\r') && !inQuotes) {
                    current.push(field.trim());
                    if (current.some(f => f.length > 0)) rows.push(current);
                    current = []; field = '';
                    if (c === '\r' && n === '\n') i++;
                } else field += c;
            }
            if (current.length > 0 || field !== '') { current.push(field.trim()); rows.push(current); }
            return rows;
        }

        async function init() {
            try {
                const res = await fetch(`${GSHEET_URL}&cb=${Date.now()}`);
                const rows = parseCSV(await res.text());
                headers = rows[0].map(h => h.replace(/"/g, '').trim());
                db = rows.slice(1).map(row => {
                    const item = {};
                    headers.forEach((h, i) => item[h] = (row[i] || '').replace(/"/g, '').trim());
                    return item;
                }).filter(r => r.Name);

                generateFilterDropdowns();
                generateTableHeader();
                
                document.getElementById('recordCount').innerText = `${db.length} Records Indexed`;
                document.getElementById('statusDot').className = 'w-1.5 h-1.5 rounded-full bg-emerald-500';
                document.getElementById('loadingOverlay').classList.add('hidden');
            } catch (err) {
                document.getElementById('loadingStatus').innerText = "FETCH ERROR";
            }
        }

        function generateTableHeader() {
            const head = document.getElementById('tableHeader');
            const displayHeaders = ["#", "Timestamp", "Name", "WhatsApp", "Experience", "Qualification", "Subjects", "Areas"];
            head.innerHTML = `<tr class="bg-slate-50/50 border-b border-slate-100 text-[9px] font-black text-slate-400 uppercase tracking-widest">
                ${displayHeaders.map(h => `<th class="px-6 py-5 ${h === '#' ? 'text-center w-14' : ''}">${h}</th>`).join('')}
            </tr>`;
        }

        function getFriendlyLabel(colName) {
            if (colName.includes('online platforms')) return "Can you teach Online";
            return colName
                .replace('You Can Teach?', '')
                .replace('you can teach in?', '')
                .replace('on online platforms such as Zoom, Skype etc.?', '')
                .trim();
        }

        function generateFilterDropdowns() {
            const grid = document.getElementById('filterGrid');
            grid.innerHTML = '';
            
            FILTER_COLS.forEach(colName => {
                const container = document.createElement('div');
                container.className = 'space-y-1.5';
                const friendlyLabel = getFriendlyLabel(colName);
                const onChangeFn = colName === 'City' ? "handleCityChange()" : "manualFilter()";

                container.innerHTML = `
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-3 truncate block tracking-tighter">${friendlyLabel}</label>
                    <select id="filter_${colName}" onchange="${onChangeFn}" class="w-full p-4 rounded-2xl bg-slate-50 border-2 border-slate-100 focus:border-lime-500 focus:bg-white text-xs font-bold text-slate-700 transition-all shadow-sm">
                        <option value="">All ${friendlyLabel}</option>
                    </select>`;
                grid.appendChild(container);
            });

            updateDropdownOptions('Gender', 'Gender');
            updateDropdownOptions('City', 'City');
            updateDropdownOptions('Years of Experience', 'Years of Experience');
            updateDropdownOptions('Educational Background', 'Educational Background');
            updateDropdownOptions('Classes You Can Teach?', 'Classes You Can Teach?'); // Special grouping logic
            updateDropdownOptions('Subjects you can teach?', 'Subjects you can teach?', /[,/&;.]/);
            updateDropdownOptions('Areas you can teach in?', 'Areas you can teach in?', /[,/&;.]/);
            updateDropdownOptions('Can you teach on online platforms such as Zoom, Skype etc.?', 'Can you teach on online platforms such as Zoom, Skype etc.?');
        }

        function updateDropdownOptions(colName, dbKey, splitBy = null, filterCity = null) {
            const select = document.getElementById(`filter_${colName}`);
            const friendlyLabel = getFriendlyLabel(colName);
            
            // Educational Background Binary logic
            if (colName === 'Educational Background') {
                select.innerHTML = `<option value="">All ${friendlyLabel}</option>
                                    <option value="o/a level">O/A Level</option>
                                    <option value="matric/fsc">Matric/FSc</option>`;
                return;
            }

            // Classes Grouping logic
            if (colName === 'Classes You Can Teach?') {
                select.innerHTML = `<option value="">All ${friendlyLabel}</option>` + 
                    Object.keys(CLASS_GROUPS).map(group => `<option value="${group}">${group}</option>`).join('');
                return;
            }

            let canonicals = new Map();
            const contextDb = filterCity 
                ? db.filter(r => (r.City || '').toLowerCase().includes(filterCity.toLowerCase()))
                : db;

            contextDb.forEach(r => {
                let val = r[dbKey] || '';
                let items = splitBy ? val.split(splitBy) : [val];
                items.forEach(p => {
                    let clean = p.trim().toLowerCase().replace(/\s+/g, ' ');
                    if (clean.length < 2 || clean.length > 35) return;
                    let found = false;
                    for (let [canon] of canonicals) {
                        if (similarity(clean, canon) > 0.82) { found = true; break; }
                    }
                    if (!found) canonicals.set(clean, true);
                });
            });

            const sortedOptions = [...canonicals.keys()].sort();
            const currentValue = select.value;
            select.innerHTML = `<option value="">All ${friendlyLabel}</option>` + 
                sortedOptions.map(opt => `<option value="${opt}">${opt.charAt(0).toUpperCase() + opt.slice(1)}</option>`).join('');
            if (sortedOptions.includes(currentValue)) select.value = currentValue;
        }

        function handleCityChange() {
            const cityValue = document.getElementById('filter_City').value;
            updateDropdownOptions('Areas you can teach in?', 'Areas you can teach in?', /[,/&;.]/, cityValue || null);
            manualFilter();
        }

        function handleSmartPaste() {
            const text = document.getElementById('smartPasteArea').value.toLowerCase();
            if (!text) return;

            const cityDropdown = document.getElementById('filter_City');
            const cityOptions = Array.from(cityDropdown.options).map(o => o.value).filter(Boolean);
            const foundCity = cityOptions.find(city => text.includes(city));
            if (foundCity) cityDropdown.value = foundCity;

            handleCityChange();

            const areaDropdown = document.getElementById('filter_Areas you can teach in?');
            const areaOptions = Array.from(areaDropdown.options).map(o => o.value).filter(Boolean);
            const foundArea = areaOptions.find(area => text.includes(area));
            if (foundArea) areaDropdown.value = foundArea;

            const subDropdown = document.getElementById('filter_Subjects you can teach?');
            const subOptions = Array.from(subDropdown.options).map(o => o.value).filter(Boolean);
            let targetSub = "";
            for (const [abbr, full] of Object.entries(MAPPING.subjects)) {
                if (text.includes(abbr)) {
                    targetSub = subOptions.find(o => o.includes(full)) || "";
                    if (targetSub) break;
                }
            }
            if (targetSub) subDropdown.value = targetSub;

            const eduDropdown = document.getElementById('filter_Educational Background');
            if (OA_LEVEL_REGEX.test(text)) {
                eduDropdown.value = "o/a level";
            } else if (text.includes('matric') || text.includes('fsc')) {
                eduDropdown.value = "matric/fsc";
            }

            const classDropdown = document.getElementById('filter_Classes You Can Teach?');
            for (const [group, keywords] of Object.entries(CLASS_GROUPS)) {
                if (keywords.some(k => text.includes(k))) {
                    classDropdown.value = group;
                    break;
                }
            }

            const onlineDropdown = document.getElementById('filter_Can you teach on online platforms such as Zoom, Skype etc.?');
            if (text.includes('home') || text.includes('physical')) onlineDropdown.value = "no";
            else if (text.includes('online') || text.includes('zoom')) onlineDropdown.value = "yes";

            const genderDropdown = document.getElementById('filter_Gender');
            if (text.includes('male') && !text.includes('female')) genderDropdown.value = "male";
            else if (text.includes('female')) genderDropdown.value = "female";

            manualFilter();
        }

        function manualFilter() {
            currentPage = 1;
            const activeFilters = [];
            FILTER_COLS.forEach(col => {
                const val = document.getElementById(`filter_${col}`).value;
                if (val) activeFilters.push({ col, val });
            });

            filteredDb = db.filter(r => {
                return activeFilters.every(f => {
                    const rowVal = (r[f.col] || '').toLowerCase();
                    
                    // Logic for Educational Background
                    if (f.col === 'Educational Background') {
                        const fullEduText = ((r['Educational Background'] || '') + ' ' + (r['Highest Qualification & Institute'] || '')).toLowerCase();
                        const hasOA = OA_LEVEL_REGEX.test(fullEduText);
                        if (f.val === 'o/a level') return hasOA;
                        if (f.val === 'matric/fsc') return !hasOA;
                        return true;
                    }

                    // Logic for Meaningful Class Groups
                    if (f.col === 'Classes You Can Teach?') {
                        const keywords = CLASS_GROUPS[f.val] || [];
                        return keywords.some(k => rowVal.includes(k));
                    }

                    return rowVal.includes(f.val) || similarity(rowVal, f.val) > 0.4;
                });
            });

            renderPage();
        }

        function changePage(direction) {
            const totalPages = Math.ceil(filteredDb.length / pageSize);
            const next = currentPage + direction;
            if (next >= 1 && next <= totalPages) {
                currentPage = next;
                renderPage();
                window.scrollTo({ top: document.getElementById('resultsWrapper').offsetTop - 100, behavior: 'smooth' });
            }
        }

        function renderPage() {
            const body = document.getElementById('tableBody');
            body.innerHTML = '';
            const totalMatches = filteredDb.length;
            const totalPages = Math.ceil(totalMatches / pageSize);
            document.getElementById('matchCount').innerText = `${totalMatches} MATCHES`;
            
            if(totalMatches === 0) {
                document.getElementById('resultsWrapper').classList.add('hidden');
                document.getElementById('emptyState').classList.remove('hidden');
                return;
            }

            const start = (currentPage - 1) * pageSize;
            const pageData = filteredDb.slice(start, start + pageSize);

            pageData.forEach((t, i) => {
                const phone = (t['WhatsApp number'] || '').replace(/\D/g,'');
                body.innerHTML += `
                    <tr class="hover:bg-lime-50/70 transition-all text-[11px] group font-medium animate-fade-in">
                        <td class="px-6 py-6 text-center font-black text-slate-300 group-hover:text-lime-500">${start + i + 1}</td>
                        <td class="px-6 py-5 text-slate-400 uppercase text-[9px] font-black">${t.Timestamp}</td>
                        <td class="px-6 py-5 font-black text-slate-800 text-sm uppercase">${t.Name}</td>
                        <td class="px-6 py-5">
                            <a href="https://wa.me/${phone}" target="_blank" class="inline-flex items-center gap-2 bg-emerald-50 text-emerald-700 px-4 py-2.5 rounded-2xl font-black hover:bg-emerald-600 hover:text-white transition-all shadow-sm">
                                <i class="fab fa-whatsapp"></i> ${t['WhatsApp number']}
                            </a>
                        </td>
                        <td class="px-6 py-5 font-bold text-slate-500 italic uppercase">${t['Years of Experience']}</td>
                        <td class="px-6 py-5 italic leading-tight max-w-[250px]">${t['Highest Qualification & Institute']}</td>
                        <td class="px-6 py-5 font-bold text-slate-700 max-w-[300px] leading-relaxed">${t['Subjects you can teach?']}</td>
                        <td class="px-6 py-5 italic max-w-[200px] leading-tight">${t['Areas you can teach in?']}</td>
                    </tr>`;
            });

            const pageStr = `Page ${currentPage} of ${totalPages || 1}`;
            document.getElementById('pageInfo').innerText = pageStr;
            document.getElementById('pageInfoBottom').innerText = pageStr;
            document.getElementById('prevBtn').disabled = document.getElementById('prevBtnBottom').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = document.getElementById('nextBtnBottom').disabled = currentPage === totalPages || totalPages === 0;
            
            document.getElementById('resultsWrapper').classList.remove('hidden');
            document.getElementById('emptyState').classList.add('hidden');
        }

        function resetFilters() {
            document.getElementById('smartPasteArea').value = '';
            FILTER_COLS.forEach(col => {
                const el = document.getElementById(`filter_${col}`);
                if (el) el.selectedIndex = 0;
            });
            updateDropdownOptions('Areas you can teach in?', 'Areas you can teach in?', /[,/&;.]/);
            filteredDb = []; currentPage = 1;
            document.getElementById('resultsWrapper').classList.add('hidden');
            document.getElementById('emptyState').classList.remove('hidden');
        }

        window.onload = init;

        const manifest = {
            "name": "Tutor Database Pro", "short_name": "Tutors", "start_url": ".", "display": "standalone",
            "background_color": "#f7fee7", "theme_color": "#84cc16",
            "icons": [{ "src": "https://cdn-icons-png.flaticon.com/512/3135/3135715.png", "sizes": "512x512", "type": "image/png" }]
        };
        document.getElementById('manifest-link').setAttribute('href', URL.createObjectURL(new Blob([JSON.stringify(manifest)], {type: 'application/json'})));
    </script>
</body>
</html>
